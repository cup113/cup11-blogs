# D34. çŠ¶æ€ç®¡ç† pinia

## 4.1. ğŸ”„ çŠ¶æ€å…±äº«ç®€åŒ–å†—ä½™çš„ç»„ä»¶é—´ä¼ é€’

> **ä¼ ç»Ÿç»„ä»¶é€šä¿¡ç—›ç‚¹**ï¼šçˆ¶å­ç»„ä»¶é€šè¿‡ `props` å’Œ `events` ä¼ é€’æ•°æ®ï¼ŒåµŒå¥—å±‚çº§å¤šæ—¶ä»£ç å†—ä½™ä¸”éš¾ä»¥ç»´æŠ¤ã€‚

### é—®é¢˜åœºæ™¯
```javascript
// çˆ¶ç»„ä»¶éœ€è¦å°† count ä¼ é€’ç»™å¤šä¸ªå­ç»„ä»¶
<template>
  <ChildA :count="count" @increment="count++" />
  <ChildB :count="count" />
  <ChildC :count="count" />
</template>
```

### Pinia è§£å†³æ–¹æ¡ˆ
```javascript
// åˆ›å»ºå…¨å±€ store
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', {
  state: () => ({ count: 0 }),
  actions: {
    increment() { this.count++ }
  }
})

// ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨
<template>
  <div>{{ counter.count }}</div>
  <button @click="counter.increment()">+1</button>
</template>

<script setup>
import { useCounterStore } from '@/stores/counter'
const counter = useCounterStore()
</script>
```

## 4.2. ğŸ› ï¸ çŠ¶æ€ç®¡ç†å¢å¼ºå°è£…ç‰¹æ€§

### æ ¸å¿ƒä¼˜åŠ¿
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¯ä¸ª store ç‹¬ç«‹ç®¡ç†è‡ªèº«çŠ¶æ€ï¼Œé¿å…å‘½åå†²çª
- **ç»„åˆå¼ API**ï¼šä¸ Vue3 çš„ `setup()` è¯­æ³•æ— ç¼é›†æˆ
- **TypeScript æ”¯æŒ**ï¼šè‡ªåŠ¨æ¨å¯¼ç±»å‹æ— éœ€é¢å¤–å®šä¹‰
- **è½»é‡é«˜æ•ˆ**ï¼šä»… 1KB å·¦å³ï¼Œæ— å†—ä½™é…ç½®

#### ç”¨ä¾‹ï¼šæ¨¡å—åŒ–æ‹†åˆ†
```javascript
// store/modules/user.js
export const useUserStore = defineStore('user', {
  state: () => ({ name: 'Vue' }),
  actions: { login() { this.name = 'Logged' } }
})

// store/modules/cart.js
export const useCartStore = defineStore('cart', {
  state: () => ({ items: [] }),
  actions: { addToCart(item) { this.items.push(item) } }
})
```

## 4.3. ğŸŒŸ Pinia æ˜¯ Vue3 çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

### ä¸ Vuex çš„å¯¹æ¯”
| ç‰¹æ€§            | Vuex                           | Pinia                                |
| --------------- | ------------------------------ | ------------------------------------ |
| æ ¸å¿ƒæ¦‚å¿µ        | state/mutation/actions/getters | state/actions/gettersï¼ˆæ—  mutationï¼‰ |
| API é£æ ¼        | é€‰é¡¹å¼é…ç½®ä¸ºä¸»                 | ç»„åˆå¼ API ä¼˜å…ˆï¼Œæ”¯æŒé€‰é¡¹å¼          |
| æ¨¡å—åŒ–          | éœ€åµŒå¥— modules                 | æ¯ä¸ª store ç‹¬ç«‹æ–‡ä»¶                  |
| ä½“ç§¯            | è¾ƒå¤§ï¼ˆå«å†—ä½™é€»è¾‘ï¼‰             | æå°ï¼ˆä»… 1KBï¼‰                       |
| TypeScript æ”¯æŒ | éœ€é¢å¤–é…ç½®                     | åŸç”Ÿæ·±åº¦æ”¯æŒ                         |

### æ ¸å¿ƒæ¦‚å¿µ
1. **Stateï¼ˆçŠ¶æ€ï¼‰**
   ```javascript
   state: () => ({ count: 0 })
   ```

2. **Gettersï¼ˆæ´¾ç”ŸçŠ¶æ€ï¼‰**
   ```javascript
   getters: {
     doubleCount: (state) => state.count * 2
   }
   ```

3. **Actionsï¼ˆæ“ä½œï¼‰**
   ```javascript
   actions: {
     increment() { this.count++ }
   }
   ```

4. **$patch å’Œ $reset**
   ```javascript
   // æ‰¹é‡æ›´æ–°
   this.$patch({ count: 10, name: 'Vue3' })

   // æ¢å¤åˆå§‹çŠ¶æ€
   this.$reset()
   ```

## 4.4. ğŸš€ Pinia ç”¨ä¾‹ä»‹ç»

### ç”¨ä¾‹ 1ï¼šåŸºç¡€è®¡æ•°å™¨
```javascript
// store/counter.js
import { defineStore } from 'pinia'

export const useCounterStore = defineStore('counter', () => {
  const count = ref(0)
  const increment = () => count.value++
  return { count, increment }
})

// ç»„ä»¶ä¸­ä½¿ç”¨
<script setup>
import { useCounterStore } from '@/stores/counter'
const counter = useCounterStore()
</script>
```

### ç”¨ä¾‹ 2ï¼šæŒä¹…åŒ–å­˜å‚¨
```javascript
// å®‰è£…æ’ä»¶
npm install pinia-plugin-persistedstate

// main.js
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)

// store/user.js
export const useUserStore = defineStore('user', {
  state: () => ({
    token: localStorage.getItem('token') || ''
  }),
  persist: true // å¯ç”¨æŒä¹…åŒ–
})
```

### ç”¨ä¾‹ 3ï¼šè·¨ç»„ä»¶çŠ¶æ€å…±äº«
```javascript
// store/global.js
export const useGlobalStore = defineStore('global', {
  state: () => ({
    theme: 'light',
    isLogged: false
  })
})

// ç»„ä»¶Aè®¾ç½®ä¸»é¢˜
useGlobalStore().theme = 'dark'

// ç»„ä»¶Bç›´æ¥è¯»å–
<template>
  <div :class="global.theme">{{ global.isLogged ? 'æ¬¢è¿å›æ¥' : 'è¯·ç™»å½•' }}</div>
</template>

<script setup>
import { useGlobalStore } from '@/stores/global'
const global = useGlobalStore()
</script>
```

## çŸ¥è¯†å›é¡¾

1. **æ ¸å¿ƒä¼˜åŠ¿**ï¼š
   - çŠ¶æ€é›†ä¸­ç®¡ç† â†’ é¿å…ç»„ä»¶é—´æ•°æ®è€¦åˆ
   - æ¨¡å—åŒ–è®¾è®¡ â†’ ä»£ç ç»“æ„æ¸…æ™°
   - ç®€åŒ– API â†’ æ—  `mutation` åˆ†å±‚
2. **å…³é”®æ–¹æ³•**ï¼š
   - `$patch`ï¼šæ‰¹é‡æ›´æ–°çŠ¶æ€
   - `$reset`ï¼šæ¢å¤åˆå§‹çŠ¶æ€
   - `persist`ï¼šæ•°æ®æŒä¹…åŒ–
3. **å¯¹æ¯”è¦ç‚¹**ï¼š
   - Pinia ä¸ Vue3 åŸç”Ÿè¯­æ³•æ·±åº¦é›†æˆ
   - æ›´å°ä½“ç§¯ã€æ›´å°‘é…ç½®ã€æ›´å¥½ç±»å‹æ”¯æŒ

## è¯¾åç»ƒä¹ 

1. **å•é€‰**ï¼šä»¥ä¸‹å“ªä¸ª Pinia æ–¹æ³•ç”¨äºæ‰¹é‡æ›´æ–°çŠ¶æ€ï¼Ÿ
   - A. `$reset()`
   - B. `$patch()`
   - C. `$persist()`
   - D. `$getters()`

2. **å¡«ç©º**ï¼šPinia ä¸­é€šè¿‡______æ–¹æ³•å¯ä»¥æ¢å¤ store çš„åˆå§‹çŠ¶æ€ã€‚

3. **ç®€ç­”**ï¼šä¸ºä»€ä¹ˆè¯´ Pinia æ¯” Vuex æ›´é€‚åˆ Vue3 é¡¹ç›®ï¼Ÿ

:::details å‚è€ƒç­”æ¡ˆ
1. B
2. `$reset()`
3. Pinia ä¸ Vue3 çš„ç»„åˆå¼ API å®Œç¾é›†æˆï¼Œå»é™¤äº†å†—ä½™çš„ mutation åˆ†å±‚ï¼Œæä¾›æ›´ç®€æ´çš„ API å’Œæ›´å¥½çš„ TypeScript æ”¯æŒã€‚
:::

## æ‰©å±•é˜…è¯»

- [Pinia å®˜æ–¹æ–‡æ¡£](https://pinia.vuejs.org/)
- [Pinia ä¸ Vuex å¯¹æ¯”](https://pinia.vuejs.org/cookbook/compare-with-vuex.html)
- [Pinia æŒä¹…åŒ–æ’ä»¶](https://github.com/prazdevs/pinia-plugin-persistedstate)
- [Pinia å¼€å‘è€…å·¥å…·](https://pinia.vuejs.org/cookbook/debugging.html)
