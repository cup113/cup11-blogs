# B41. æµè§ˆå™¨ BOM å¯¹è±¡ & æ•°å­¦æ¨¡å—

> JavaScript ä¸ä»…èƒ½æ“ä½œç½‘é¡µå†…å®¹ï¼ˆDOMï¼‰ï¼Œè¿˜èƒ½ä¸æµè§ˆå™¨è¿›è¡Œæ·±åº¦äº¤äº’ã€‚BOMï¼ˆBrowser Object Modelï¼‰å°±æ˜¯æµè§ˆå™¨ä¸ºæˆ‘ä»¬æä¾›çš„å¯¹è±¡æ¨¡å‹ï¼Œå®ƒè®©æˆ‘ä»¬å¯ä»¥è®¿é—®çª—å£ã€å±å¹•ã€å†å²è®°å½•ç­‰ä¿¡æ¯ã€‚ä¸æ­¤åŒæ—¶ï¼ŒJavaScript çš„ `Math` æ¨¡å—ä¹Ÿæä¾›äº†ä¸°å¯Œçš„æ•°å­¦è¿ç®—åŠŸèƒ½ã€‚

## 1.1. `window` å¯¹è±¡ï¼šæµè§ˆå™¨çš„â€œå¤§ç®¡å®¶â€

> åŒå­¦ä»¬è¿˜è®°å¾—ç”¨ Python å†™çš„ `print("Hello World")` å—ï¼Ÿåœ¨ç½‘é¡µä¸­ï¼Œå¦‚æœæƒ³å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†æ˜¾ç¤ºä¿¡æ¯ï¼Œå°±éœ€è¦ç”¨åˆ° `window.alert()`ã€‚`window` å¯¹è±¡å°±åƒ JavaScript çš„â€œå¤§ç®¡å®¶â€ï¼Œæ§åˆ¶ç€æµè§ˆå™¨çª—å£çš„ä¸€åˆ‡è¡Œä¸ºï¼

### 1.1.1. å¸¸ç”¨å±æ€§ä¸æ–¹æ³•

```javascript
// è·å–çª—å£å®½é«˜ï¼ˆåŒ…å«æ»šåŠ¨æ¡ï¼‰
console.log("çª—å£å®½åº¦ï¼š" + window.innerWidth);
console.log("çª—å£é«˜åº¦ï¼š" + window.innerHeight);

// æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
window.scrollTo(0, 0);

// æ‰“å¼€æ–°çª—å£ï¼ˆæ³¨æ„å¹¿å‘Šæ‹¦æˆªå™¨å¯èƒ½æ‹¦æˆªï¼ï¼‰
window.open("https://example.com", "_blank");
```

:::warning
âš ï¸ **æ˜“é”™ç‚¹**  
`window.innerWidth` å’Œ `screen.width` å®¹æ˜“æ··æ·†ï¼šå‰è€…æ˜¯æµè§ˆå™¨çª—å£çš„å¯è§†åŒºåŸŸå®½åº¦ï¼Œåè€…æ˜¯å±å¹•ç‰©ç†åˆ†è¾¨ç‡çš„å®½åº¦ã€‚
:::

## 1.2. `screen` ä¸ `navigator`ï¼šè·å–è®¾å¤‡å’Œæµè§ˆå™¨ä¿¡æ¯

> ä¸ºä»€ä¹ˆæœ‰äº›ç½‘ç«™åœ¨æ‰‹æœºä¸Šä¼šæ˜¾ç¤ºæ‰‹æœºç‰ˆç•Œé¢ï¼Ÿè¿™å°±è¦ç”¨åˆ° `screen` å¯¹è±¡è·å–å±å¹•ä¿¡æ¯å•¦ï¼å†æ¯”å¦‚ï¼Œå¦‚ä½•çŸ¥é“ç”¨æˆ·ç”¨çš„æ˜¯ Chrome è¿˜æ˜¯ Safariï¼Ÿ`navigator` å¯¹è±¡æ¥å¸®å¿™ï¼

### 1.2.1. `screen` å¯¹è±¡

```javascript
// è·å–å±å¹•åˆ†è¾¨ç‡
console.log("å±å¹•å®½åº¦ï¼š" + screen.width);
console.log("å±å¹•é«˜åº¦ï¼š" + screen.height);

// å¯ç”¨å·¥ä½œåŒºåŸŸï¼ˆæ‰£é™¤ä»»åŠ¡æ ï¼‰
console.log("å¯ç”¨é«˜åº¦ï¼š" + screen.availHeight);
```

### 1.2.2. `navigator` å¯¹è±¡

```javascript
// è¯†åˆ«æµè§ˆå™¨ç±»å‹
if (navigator.userAgent.includes("Chrome")) {
  console.log("ä½ æ­£åœ¨ä½¿ç”¨ Chrome æµè§ˆå™¨");
}
```

## 1.3. `location` ä¸ `history`ï¼šé¡µé¢è·³è½¬ä¸å†å²å¯¼èˆª

> æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œç‚¹å‡»â€œè¿”å›â€æŒ‰é’®æ—¶æµè§ˆå™¨åšäº†ä»€ä¹ˆï¼Ÿ`history.back()` å°±æ˜¯ç­”æ¡ˆï¼å¦‚æœæƒ³è®©ç½‘é¡µè‡ªåŠ¨è·³è½¬åˆ°æ–°åœ°å€ï¼Œ`location.href` æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ã€‚

### 1.3.1. `location` å¯¹è±¡

```javascript
// è·å–å½“å‰ URL
console.log("å½“å‰åœ°å€ï¼š" + location.href);

// è·³è½¬åˆ°æ–°é¡µé¢ï¼ˆ5ç§’åè·³è½¬ï¼‰
setTimeout(() => {
  location.href = "https://newpage.com";
}, 5000);
```

:::tip
ğŸ“Œ **æŠ€å·§æç¤º**
- `location.search`ï¼šè·å–æŸ¥è¯¢å‚æ•°ï¼ˆå¦‚ `?id=123`ï¼‰
- `location.hash`ï¼šè·å–é”šç‚¹éƒ¨åˆ†ï¼ˆå¦‚ `#section1`ï¼‰
:::

### 1.3.2. `history` å¯¹è±¡

```javascript
// è¿”å›ä¸Šä¸€é¡µï¼ˆç­‰åŒäºæµè§ˆå™¨åé€€æŒ‰é’®ï¼‰
history.back();

// å‰è¿›åˆ°ä¸‹ä¸€é¡µ
history.forward();

// è·³è½¬åˆ°æœ€è¿‘çš„ç¬¬ä¸‰ä¸ªå†å²è®°å½•
history.go(-3);
```

:::warning
âš ï¸ **æ˜“é”™ç‚¹**
- `location.replace()` ä¸ä¼šåœ¨å†å²è®°å½•ä¸­ç•™ä¸‹å½“å‰é¡µé¢ï¼Œé€‚åˆå•å‘è·³è½¬ï¼›
- `location.href` ä¼šä¿ç•™å½“å‰é¡µé¢åœ¨å†å²è®°å½•ä¸­ã€‚
:::

## 1.4. `Math` æ¨¡å—ï¼šæ•°å­¦è®¡ç®—çš„å·¥å…·ç®±

> åœ¨ Python ä¸­æˆ‘ä»¬ç”¨ `import math`ï¼Œè€Œ JavaScript çš„æ•°å­¦å‡½æ•°ç›´æ¥é€šè¿‡ `Math` å¯¹è±¡è°ƒç”¨ã€‚æ¨¡å—åŒ–å°±åƒæŠŠå·¥å…·åˆ†é—¨åˆ«ç±»æ”¾åœ¨å·¥å…·ç®±é‡Œï¼Œè¦ç”¨çš„æ—¶å€™ç›´æ¥å–ï¼

### 1.4.1. æ¨¡å—åŒ–çš„æ„ä¹‰

- é¿å…å‘½åå†²çªï¼ˆæ¯”å¦‚è‡ªå·±å†™çš„ `random()` ä¸ä¼šè¦†ç›–ç³»ç»Ÿå‡½æ•°ï¼‰
- ä»£ç å¤ç”¨æ›´æ–¹ä¾¿
- é€»è¾‘æ›´æ¸…æ™°

## 1.5. `Math` å¸¸ç”¨æ–¹æ³•ä¸å¸¸é‡ {#15-math}

> å¦‚ä½•è®©ç½‘é¡µä¸Šçš„å°çƒéšæœºç§»åŠ¨ï¼Ÿç”¨ `Math.random()` ç”Ÿæˆéšæœºåæ ‡ï¼è¿˜è®°å¾—åœ†å‘¨ç‡ Ï€ å—ï¼Ÿç›´æ¥ç”¨ `Math.PI` å°±èƒ½è·å–ã€‚

### 1.5.1. å¸¸ç”¨æ–¹æ³•

`Math.random()` è¿”å› `[0,1)` åŒºé—´çš„éšæœºæ•°ï¼Œæ‰€ä»¥è¦å¾—åˆ° `[m, n]` ä¹‹é—´çš„éšæœºæ•´æ•°ï¼Œéœ€è¦ä½¿ç”¨ `Math.floor(Math.random() * (n - m + 1)) + m`ã€‚

```javascript
// ç”Ÿæˆ 1~10 çš„éšæœºæ•´æ•°
let num = Math.floor(Math.random() * 10) + 1;

// è®¡ç®—å¹³æ–¹æ ¹
console.log(Math.sqrt(16)); // è¾“å‡º 4

// å–ç»å¯¹å€¼
console.log(Math.abs(-5.8)); // è¾“å‡º 5.8
```

### 1.5.2. å¸¸ç”¨å¸¸é‡

```javascript
console.log(Math.PI); // åœ†å‘¨ç‡ Ï€ â‰ˆ 3.14159...
console.log(Math.E);  // è‡ªç„¶å¯¹æ•°çš„åº•æ•° e â‰ˆ 2.71828...
```

:::warning
âš ï¸ **æ˜“é”™ç‚¹**

- `Math.floor()` æ˜¯å‘ä¸‹å–æ•´
- `Math.ceil()` æ˜¯å‘ä¸Šå–æ•´
- `Math.round()` æ˜¯å››èˆäº”å…¥

åˆ«è®°æ··äº†ï¼
:::

## ğŸ“š çŸ¥è¯†å›é¡¾

| å¯¹è±¡ | ä¸»è¦ç”¨é€” |
|------|----------|
| `window` | æ§åˆ¶æµè§ˆå™¨çª—å£ã€æ‰§è¡Œå…¨å±€æ“ä½œ |
| `screen` | è·å–è®¾å¤‡å±å¹•ä¿¡æ¯ |
| `navigator` | è·å–æµè§ˆå™¨ä¿¡æ¯ï¼ˆå¦‚ userAgentï¼‰ |
| `location` | ç®¡ç†é¡µé¢åœ°å€ï¼ˆè·³è½¬ã€åˆ·æ–°ï¼‰ |
| `history` | æ§åˆ¶é¡µé¢å†å²è®°å½•ï¼ˆå‰è¿›ã€åé€€ï¼‰ |
| `Math` | æä¾›æ•°å­¦è¿ç®—ï¼ˆéšæœºæ•°ã€å¹³æ–¹æ ¹ã€åœ†å‘¨ç‡ç­‰ï¼‰ |

## ğŸ§ª è¯¾åç»ƒä¹ 

### âœ… åŸºç¡€é¢˜

1. ï¼ˆé€‰æ‹©ï¼‰ä»¥ä¸‹å“ªé¡¹å¯ä»¥è·å–æµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†ä¿¡æ¯ï¼Ÿ
   - A. `window.userAgent`
   - B. `navigator.userAgent` âœ…
   - C. `screen.userAgent`

2. ï¼ˆå¡«ç©ºï¼‰ç”Ÿæˆ 5~10 çš„éšæœºæ•´æ•°ï¼š
   ```javascript
   Math.floor(Math.random() * ___) + ___
   ```
   â†’ ç­”æ¡ˆï¼š6 å’Œ 5

3. ï¼ˆçº é”™ï¼‰æ‰¾å‡ºä»£ç é”™è¯¯ï¼š
   ```javascript
   let url = location.address; // âŒ é”™è¯¯ï¼æ­£ç¡®åº”ä¸º location.href
   ```

### ğŸ¯ é¡¹ç›®é¢˜ï¼šåˆ¶ä½œä¸€ä¸ªâ€œç½‘é¡µå°åŠ©æ‰‹â€

**è¦æ±‚**ï¼š

1. ç‚¹å‡»æŒ‰é’®æ˜¾ç¤ºå½“å‰çª—å£å®½é«˜
2. ç‚¹å‡»å¦ä¸€ä¸ªæŒ‰é’® 3 ç§’åè·³è½¬åˆ°æŒ‡å®š URL
3. æ˜¾ç¤ºç”¨æˆ·æµè§ˆå™¨åç§°ï¼ˆæç¤ºï¼šç”¨ `navigator.userAgent` åˆ†æï¼‰
4. ï¼ˆæ‹“å±•ï¼‰ç”¨ `Math.random()` å®ç°èƒŒæ™¯è‰²éšæœºå˜åŒ–

**HTML ç¤ºä¾‹ç»“æ„**ï¼š

```html
<button onclick="showWindowSize()">æ˜¾ç¤ºçª—å£å¤§å°</button>
<button onclick="redirectAfter3Sec('https://example.com')">3ç§’åè·³è½¬</button>
<p id="browser-info">æµè§ˆå™¨ä¿¡æ¯</p>
<div id="random-bg" style="width: 100%; height: 100px;"></div>
```

**JavaScript ç¤ºä¾‹é€»è¾‘**ï¼š

```javascript
function showWindowSize() {
  alert(`çª—å£å°ºå¯¸ï¼š${window.innerWidth} x ${window.innerHeight}`);
}

function redirectAfter3Sec(url) {
  setTimeout(() => {
    window.location.href = url;
  }, 3000);
}

function detectBrowser() {
  const ua = navigator.userAgent;
  let browser = "æœªçŸ¥æµè§ˆå™¨";

  if (ua.includes("Firefox")) {
    browser = "Mozilla Firefox";
  } else if (ua.includes("Edg")) {
    browser = "Microsoft Edge";
  } else if (ua.includes("Chrome")) {
    browser = "Google Chrome";
  }

  document.getElementById("browser-info").innerText = `ä½ æ­£åœ¨ä½¿ç”¨ï¼š${browser}`;
}

function randomColor() {
  const r = Math.floor(Math.random() * 256);
  const g = Math.floor(Math.random() * 256);
  const b = Math.floor(Math.random() * 256);
  return `rgb(${r}, ${g}, ${b})`;
}

function changeBackgroundColor() {
  const div = document.getElementById("random-bg");
  div.style.backgroundColor = randomColor();
}

// é¡µé¢åŠ è½½æ—¶æ£€æµ‹æµè§ˆå™¨
window.onload = detectBrowser;
```

:::info
ğŸ’¡ æç¤ºï¼šä½¿ç”¨ `setInterval(changeBackgroundColor, 1000)` å¯å®ç°æ¯ç§’å˜æ¢èƒŒæ™¯è‰²çš„åŠ¨æ€æ•ˆæœã€‚
:::
