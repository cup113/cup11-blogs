# D22. å®šä¹‰å¤æ‚ç±»å‹

## 2.1. ğŸŒŸ `keyof` è¿ç®—ç¬¦è·å¾—å¯¹è±¡æ‰€æœ‰é”®

**æ ¸å¿ƒæ€æƒ³**ï¼š
`keyof` è¿ç®—ç¬¦å¯è·å–å¯¹è±¡ç±»å‹çš„ **æ‰€æœ‰é”®**ï¼Œè¿”å›ä¸€ä¸ªç”±é”®åç»„æˆçš„ **è”åˆç±»å‹**ã€‚å®ƒé€‚ç”¨äºæ¥å£ã€ç±»ã€å¯¹è±¡ç±»å‹ç­‰ï¼Œæ˜¯ç±»å‹å®‰å…¨æ“ä½œçš„åŸºç¡€ã€‚

### 2.1.1. åŸºç¡€ç”¨æ³•ä¸ç¤ºä¾‹

**è·å–æ¥å£/ç±»çš„é”®**
```typescript
interface User {
  name: string;
  age: number;
  isAdmin: boolean;
}

type UserKeys = keyof User; // "name" | "age" | "isAdmin"

function getProperty<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key]; // ç±»å‹å®‰å…¨ï¼Œç¡®ä¿ key å­˜åœ¨
}

const user = { name: "Alice", age: 25, isAdmin: false };
const name = getProperty(user, "name"); // ç±»å‹æ¨æ–­ä¸º string
// const invalid = getProperty(user, "address"); // âŒ é”™è¯¯ï¼šé”®ä¸å­˜åœ¨
```

**å®ç°ç±»å‹å®‰å…¨çš„ç´¢å¼•è®¿é—®**
é€šè¿‡ `keyof` çº¦æŸæ³›å‹å‚æ•°ï¼Œé¿å…ä½¿ç”¨ `any`ï¼š
```typescript
// é”™è¯¯ç¤ºä¾‹ï¼šä½¿ç”¨ any å¯èƒ½å¯¼è‡´ç±»å‹ä¸å®‰å…¨
function unsafeGetProperty(obj: any, key: any) {
  return obj[key]; // å¯èƒ½è¿”å›ä»»æ„ç±»å‹
}

// æ­£ç¡®ç¤ºä¾‹ï¼šç±»å‹å®‰å…¨ä¸”ç²¾å‡†
const age = getProperty(user, "age"); // ç±»å‹æ¨æ–­ä¸º number
```

### 2.1.2. ç‰¹æ®Šåœºæ™¯ä¸æ³¨æ„äº‹é¡¹

**è”åˆç±»å‹çš„é”®å–äº¤é›†**
```typescript
type A = { a: string; common: number };
type B = { b: string; common: number };

type KeysOfUnion = keyof (A | B); // "common"ï¼ˆå–äº¤é›†ï¼‰
```

**äº¤å‰ç±»å‹çš„é”®å–å¹¶é›†**
```typescript
type A = { a: string; shared: number };
type B = { b: string; shared: number };
type C = A & B;

type KeysOfIntersection = keyof C; // "a" | "b" | "shared"
```

**æ•°ç»„çš„é”®åŒ…å«ç´¢å¼•å’Œæ–¹æ³•**
```typescript
type ArrayKeys = keyof string[]; // "length" | "toString" | "join" | ... | number
// æ•°ç»„çš„ç´¢å¼•ï¼ˆ0ã€1ã€2 ç­‰ï¼‰ä¼šè¢«è½¬ä¸ºå­—ç¬¦ä¸²å½¢å¼
```

:::warning æ³¨æ„
è‹¥å¯¹è±¡çš„é”®åæ˜¯æ•°å­—æˆ–ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€ç”¨å¼•å·åŒ…è£¹ï¼š
```typescript
const obj = { "123": "value", specialKey: "test" };
type ObjKeys = keyof typeof obj; // "123" | "specialKey"
```
:::

## 2.2. ğŸŒŸ `interface` è¯­å¥å®šä¹‰å¸¸è§çš„å¯¹è±¡ç±»å‹

**æ ¸å¿ƒæ€æƒ³**ï¼š
`interface` æ˜¯ TypeScript å®šä¹‰å¯¹è±¡ç»“æ„çš„æ ¸å¿ƒå·¥å…·ï¼Œå¯å£°æ˜ **å¿…å¡«å±æ€§**ã€**å¯é€‰å±æ€§**ã€**åªè¯»å±æ€§**ï¼Œå¹¶æ”¯æŒç»§æ‰¿å’Œæ‰©å±•ã€‚

### 2.2.1. åŸºç¡€å®šä¹‰ä¸æ‰©å±•

**å¿…å¡«å±æ€§**
```typescript
interface User {
  name: string; // å¿…å¡«
  age: number; // å¿…å¡«
}

const user: User = { name: "Bob" }; // âŒ é”™è¯¯ï¼šage ç¼ºå¤±
```

**å¯é€‰å±æ€§**
```typescript
interface User {
  name: string;
  age?: number; // å¯é€‰å±æ€§
}

const user: User = { name: "Charlie" }; // åˆæ³•
```

**åªè¯»å±æ€§**
```typescript
interface Config {
  readonly host: string; // åªè¯»å±æ€§
  port: number;
}

const config: Config = { host: "localhost", port: 3000 };
config.host = "remote"; // âŒ é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹åªè¯»å±æ€§
```

### 2.2.2. ç»§æ‰¿ä¸æ··åˆç±»å‹

**ç»§æ‰¿æ¥å£**
```typescript
interface Admin extends User {
  role: "admin"; // æ–°å¢å¿…å¡«å±æ€§
}

const admin: Admin = {
  name: "Diana",
  role: "admin",
  age: 30 // å¯é€‰å±æ€§å¯ä¿ç•™
};
```

**å¯é€‰ + åªè¯»ç»„åˆ**
```typescript
interface ReadOnlyUser {
  readonly id: number; // åªè¯»ä¸”å¿…å¡«
  name?: string; // å¯é€‰ä¸”åªè¯»ï¼Ÿ
}

// â— æ³¨æ„ï¼šTypeScript æ— â€œåªè¯»å¯é€‰â€è¯­æ³•ï¼Œéœ€ç”¨ç±»å‹æ–­è¨€å¤„ç†
```

## 2.3. ğŸŒŸ `keyof` è¡ç”Ÿçš„é”®å€¼å¯¹å®šä¹‰è¯­æ³•

**æ ¸å¿ƒæ€æƒ³**ï¼š
ç»“åˆ `keyof` å’Œ **ç´¢å¼•è®¿é—®ç±»å‹**ï¼ˆ`T[K]`ï¼‰ï¼Œå¯å®ç° **é”®å€¼å¯¹çš„ç²¾å‡†ç±»å‹çº¦æŸ**ï¼Œå¸¸è§äºæ³›å‹å‡½æ•°æˆ–å·¥å…·ç±»å‹ã€‚

### 2.3.1. ç´¢å¼•è®¿é—®ç±»å‹ `T[K]`

**ç¤ºä¾‹ï¼šåŠ¨æ€è·å–å±æ€§å€¼ç±»å‹**
```typescript
interface Product {
  id: number;
  name: string;
  price: number;
}

type ProductId = Product["id"]; // number
type ProductNameOrPrice = Product["name" | "price"]; // string | number
```

**æ³›å‹å‡½æ•°ä¸­çš„åº”ç”¨**
```typescript
function getValue<T, K extends keyof T>(obj: T, key: K): T[K] {
  return obj[key];
}

const price = getValue<Product, "price">(product, "price"); // ç±»å‹ä¸º number
```

### 2.3.2. å·¥å…·ç±»å‹å®ç°ï¼š`Pick` å’Œ `Readonly`

**å®ç° `Pick`**
```typescript
type Pick<T, K extends keyof T> = {
  [P in K]: T[P]; // éå† K ä¸­çš„æ¯ä¸ªé”®ï¼Œå¤åˆ¶ç±»å‹
};

type ProductDetails = Pick<Product, "name" | "price">;
// ç­‰ä»·äº { name: string; price: number; }
```

**å®ç° `Readonly`**
```typescript
type Readonly<T> = {
  readonly [P in keyof T]: T[P]; // æ‰€æœ‰å±æ€§æ ‡è®°ä¸ºåªè¯»
};

type ReadOnlyUser = Readonly<User>; // æ‰€æœ‰å±æ€§å˜ä¸ºåªè¯»
```

## 2.4. ğŸŒŸ `keyof` ç›¸å…³çš„ç±»å‹ä½“æ“

**æ ¸å¿ƒæ€æƒ³**ï¼š
ç»“åˆ `keyof`ã€æ³›å‹ã€æ¡ä»¶ç±»å‹ç­‰ï¼Œå®ç° **åŠ¨æ€ç±»å‹éªŒè¯**ã€**ç»“æ„è½¬æ¢** ç­‰å¤æ‚æ“ä½œã€‚

### 2.4.1. éªŒè¯å¯¹è±¡æ˜¯å¦ç¬¦åˆé”®çº¦æŸ

**ç¡®ä¿å¯¹è±¡åŒ…å«æ‰€æœ‰å¿…éœ€é”®**
```typescript
type RequiredKeys<T> = { [K in keyof T]-?: unknown }; // å¼ºåˆ¶å¿…å¡«

type Validate<T, U> = T extends RequiredKeys<U> ? true : false;

interface RequiredUser {
  name: string;
  age: number;
}

type Check1 = Validate<{ name: string }, RequiredUser>; // falseï¼ˆç¼ºå°‘ ageï¼‰
type Check2 = Validate<{ name: string; age: number }, RequiredUser>; // true
```

### 2.4.2. åŠ¨æ€æå–é”®å€¼ç±»å‹

**æå–å‡½æ•°è¿”å›å€¼çš„ç±»å‹**
```typescript
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : any;

function getUser(): { name: string; id: number } {
  return { name: "Eve", id: 1 };
}

type UserReturnType = ReturnType<typeof getUser>; // { name: string; id: number }
```

### 2.4.3. æ„å»ºé”®å€¼å¯¹æ˜ å°„ç±»å‹

**å°†é”®è½¬ä¸º `key-value` å¯¹æ•°ç»„**
```typescript
type Entries<T> = {
  [K in keyof T]: [K, T[K]];
}[keyof T][]; // è”åˆç±»å‹è½¬æ•°ç»„

type ProductEntries = Entries<Product>; // [ "id", number ] | [ "name", string ] çš„æ•°ç»„
```

**çŸ¥è¯†å›é¡¾**

1. **`keyof` è¿ç®—ç¬¦**
   - è·å–å¯¹è±¡ç±»å‹çš„æ‰€æœ‰é”®ï¼Œè¿”å›è”åˆç±»å‹ã€‚
   - è”åˆç±»å‹å–é”®çš„**äº¤é›†**ï¼Œäº¤å‰ç±»å‹å–é”®çš„**å¹¶é›†**ã€‚
2. **`interface` å®šä¹‰å¯¹è±¡**
   - æ”¯æŒå¿…å¡«ã€å¯é€‰ã€åªè¯»å±æ€§ï¼Œå¯ç»§æ‰¿æ‰©å±•ã€‚
3. **é”®å€¼å¯¹è¯­æ³•**
   - `T[K]` åŠ¨æ€è·å–å±æ€§å€¼ç±»å‹ï¼Œç»“åˆæ³›å‹å®ç°ç²¾å‡†çº¦æŸã€‚
4. **ç±»å‹ä½“æ“**
   - é€šè¿‡æ³›å‹å’Œæ¡ä»¶ç±»å‹å®ç°å¤æ‚ç±»å‹éªŒè¯ä¸è½¬æ¢ã€‚

**è¯¾åç»ƒä¹ **

1. ï¼ˆå•é€‰ï¼‰ä»¥ä¸‹ `keyof` çš„è¿”å›ç±»å‹æ˜¯ï¼Ÿ
   ```typescript
   type T = { a: 1; b: 2 };
   type Keys = keyof T;
   ```
   - A. `"a"`
   - B. `"a" | "b"`
   - C. `1 | 2`
   - D. `number`

2. ï¼ˆå¡«ç©ºï¼‰å®šä¹‰ä¸€ä¸ª `PartialAdmin` ç±»å‹ï¼Œå°† `Admin` æ¥å£çš„å±æ€§å…¨éƒ¨è®¾ä¸ºå¯é€‰ã€‚
   ```typescript
   interface Admin { id: number; role: "admin"; }
   type PartialAdmin = ___<Admin>; // å¡«å†™å·¥å…·ç±»å‹
   ```

3. ï¼ˆç¼–ç ï¼‰å®ç°ä¸€ä¸ª `KeysToOptional<T>` å·¥å…·ç±»å‹ï¼Œå°†å¯¹è±¡ç±»å‹çš„æ‰€æœ‰å±æ€§è®¾ä¸ºå¯é€‰ã€‚
   ```typescript
   type KeysToOptional<T> = { [P in ___<T>]? : T[P] };
   ```

**æ‰©å±•é˜…è¯»**

- [TypeScript å®˜æ–¹æ–‡æ¡£ - keyof](https://www.typescriptlang.org/docs/handbook/2/keyof-types.html)
- [TypeScript æ˜ å°„ç±»å‹è¯¦è§£](https://www.typescriptlang.org/docs/handbook/2/mapped-types.html)
