# D23. Typescript çš„æ¨¡å—åŒ–

## 3.1. ğŸŒŸ **ä¸º JavaScript ç¼–å†™ç±»å‹å£°æ˜æ–‡ä»¶**

### 3.1.1. å£°æ˜æ–‡ä»¶çš„ç¼–å†™æ­¥éª¤

**æ ¸å¿ƒæ€æƒ³**ï¼š
é€šè¿‡ `.d.ts` æ–‡ä»¶ä¸º JavaScript æ¨¡å—æ·»åŠ ç±»å‹ä¿¡æ¯ï¼Œå®ç°ç±»å‹å®‰å…¨çš„å¼•ç”¨ã€‚

**æ­¥éª¤ 1ï¼šåˆ›å»ºå£°æ˜æ–‡ä»¶**
```typescript
// my-js-module.d.ts
// æ³¨æ„ï¼šæ— éœ€å®ç°ä»£ç ï¼Œä»…æè¿°ç±»å‹
```

**æ­¥éª¤ 2ï¼šå®šä¹‰æ¨¡å—å¯¼å‡º**
```typescript
// å‘½åå¯¼å‡º
export declare function add(a: number, b: number): number;

// é»˜è®¤å¯¼å‡º
export default declare class Calculator {
  multiply(a: number, b: number): number;
}
```

**æ­¥éª¤ 3ï¼šå…³è”æ¨¡å—**
åœ¨ `tsconfig.json` ä¸­åŒ…å«å£°æ˜æ–‡ä»¶ï¼š
```json
{
  "include": ["src", "my-js-module.d.ts"]
}
```

### 3.1.2. å…¨å±€å˜é‡ vs æ¨¡å—å£°æ˜

**å…¨å±€å˜é‡å£°æ˜**
```typescript
// global.d.ts
declare const globalVar: string; // å£°æ˜å…¨å±€å˜é‡
declare function globalFunction(): void; // å£°æ˜å…¨å±€å‡½æ•°
```

**æ¨¡å—åŒ–å£°æ˜**
```typescript
// module-a.d.ts
export interface Config {
  host: string;
}

export function start(config: Config): void;
```

:::tip
- å…¨å±€å˜é‡å£°æ˜æ— éœ€ `export`ï¼Œç›´æ¥æŒ‚è½½åˆ°å…¨å±€ä½œç”¨åŸŸã€‚
- æ¨¡å—å£°æ˜éœ€é€šè¿‡ `import`/`require` å¼•å…¥ã€‚
:::

### 3.1.3. å®æˆ˜æ¡ˆä¾‹ï¼šç»™ç¬¬ä¸‰æ–¹åº“æ·»åŠ ç±»å‹

**åœºæ™¯**ï¼šç¬¬ä¸‰æ–¹åº“ `math-utils.js` æœªæä¾›ç±»å‹å£°æ˜ï¼Œéœ€æ‰‹åŠ¨è¡¥å…¨ã€‚

```javascript
// math-utils.js
function add(a, b) {
  return a + b;
}
function multiply(a, b) {
  return a * b;
}
export { add, multiply };
```

**å£°æ˜æ–‡ä»¶ `math-utils.d.ts`**
```typescript
// math-utils.d.ts
export declare function add(a: number, b: number): number;
export declare function multiply(a: number, b: number): number;
```

**ä½¿ç”¨ç¤ºä¾‹**
```typescript
import { add, multiply } from "./math-utils";

console.log(add(1, 2)); // åˆæ³•
// console.log(add("1", 2)); // âŒ ç±»å‹é”™è¯¯
```

## 3.2. ğŸŒŸ **export è¯­å¥ï¼šå¯¼å‡ºæˆå‘˜ä¸ç±»å‹**

### 3.2.1. å‘½åå¯¼å‡ºä¸é»˜è®¤å¯¼å‡º

**å‘½åå¯¼å‡ºï¼ˆNamed Exportï¼‰**
```typescript
// math.ts
export function add(a: number, b: number): number {
  return a + b;
}

export interface Config {
  precision: number;
}
```

**é»˜è®¤å¯¼å‡ºï¼ˆDefault Exportï¼‰**
```typescript
// calculator.ts
export default class Calculator {
  multiply(a: number, b: number): number {
    return a * b;
  }
}
```

:::tip
- å‘½åå¯¼å‡ºéœ€é€šè¿‡ `import { ... }` å¼•å…¥ï¼Œåç§°éœ€ä¸å¯¼å‡ºåä¸€è‡´ã€‚
- é»˜è®¤å¯¼å‡ºå¯ä»»æ„å‘½åï¼Œä½†éœ€ä½¿ç”¨ `import X from '...'`ã€‚
:::

### 3.2.2. å¯¼å‡ºç±»å‹ä¸æ¥å£

**å¯¼å‡ºæ¥å£**
```typescript
// types.ts
export interface User {
  id: number;
  name: string;
}

export type Status = "active" | "inactive";
```

**å¯¼å‡ºç±»å‹åˆ«å**
```typescript
// utils.ts
export type Callback = (result: any) => void;

export function process(data: any, callback: Callback): void {
  // ...
}
```

### 3.2.3. å¯¼å‡ºåˆå¹¶ä¸æ‰©å±•

**æ¥å£åˆå¹¶**
```typescript
// module-a.ts
export interface User {
  id: number;
}

// module-b.ts
export interface User {
  name: string;
}

// åˆå¹¶åï¼šUser = { id: number, name: string }
```

**ç±»å‹æ‰©å±•**
```typescript
// base.ts
export class BaseService {
  start(): void {}
}

// extended.ts
export class Service extends BaseService {
  stop(): void {}
}
```

## 3.3. ğŸŒŸ **import è¯­å¥ï¼šç²¾å‡†å¯¼å…¥ä¸ç±»å‹éš”ç¦»**

### 3.3.1. å¯¼å…¥é»˜è®¤å¯¼å‡ºä¸å‘½åå¯¼å‡º

**å¯¼å…¥å‘½åå¯¼å‡º**
```typescript
import { add, Config } from "./math";

const result = add(1, 2); // åˆæ³•
const config: Config = { precision: 2 }; // åˆæ³•
```

**å¯¼å…¥é»˜è®¤å¯¼å‡º**
```typescript
import Calculator from "./calculator";

const calc = new Calculator();
console.log(calc.multiply(3, 4)); // 12
```

**æ··åˆå¯¼å…¥**
```typescript
import Calculator, { add } from "./module"; // åŒæ—¶å¯¼å…¥é»˜è®¤å’Œå‘½åå¯¼å‡º
```

### 3.3.2. ç±»å‹å¯¼å…¥çš„ `type` è¯­æ³•

**åŒºåˆ†å€¼å’Œç±»å‹**
```typescript
// å¯¼å…¥å€¼å’Œç±»å‹
import { User } from "./types"; // åŒæ—¶å¯¼å…¥ç±»å‹å’Œå€¼ï¼ˆè‹¥å­˜åœ¨ï¼‰
import type { User } from "./types"; // ä»…å¯¼å…¥ç±»å‹ï¼Œä¸æ‰“åŒ…åˆ° JS
```

:::tip
- `import type` å¯é¿å…æ‰“åŒ…æ—¶å¼•å…¥æ— ç”¨çš„è¿è¡Œæ—¶ä»£ç ã€‚
- ç±»å‹å¯¼å…¥æ— éœ€ `declare`ï¼Œç›´æ¥ä½¿ç”¨æ¥å£/ç±»å‹åˆ«åã€‚
:::

### 3.3.3. å‘ä½è­¦ç¤ºï¼šé»˜è®¤å¯¼å‡ºçš„é™·é˜±

**é™·é˜± 1ï¼šå‘½åé”™è¯¯**
```typescript
// é”™è¯¯ç¤ºä¾‹ï¼šå°†é»˜è®¤å¯¼å‡ºå‘½åä¸ºæ¥å£
import User from "./user"; // âŒ é»˜è®¤å¯¼å‡ºæ˜¯ç±»æˆ–å‡½æ•°ï¼Œä¸èƒ½ç›´æ¥å½“ç±»å‹ä½¿ç”¨

// æ­£ç¡®å†™æ³•ï¼š
import User, { UserType } from "./user";
// UserType æ˜¯æ¥å£ï¼ŒUser æ˜¯é»˜è®¤å¯¼å‡ºçš„ç±»
```

**é™·é˜± 2ï¼šç±»å‹ä¸å€¼å†²çª**
```typescript
// user.ts
export default class User {}
export type UserConfig = { /* ... */ };

// å…¶ä»–æ–‡ä»¶
import User, { UserConfig } from "./user"; // User æ˜¯ç±»ï¼ŒUserConfig æ˜¯ç±»å‹
```

:::warning æ³¨æ„
é»˜è®¤å¯¼å‡ºçš„åç§°ä¸èƒ½ä¸å‘½åå¯¼å‡ºçš„ç±»å‹é‡åï¼
```typescript
// é”™è¯¯ç¤ºä¾‹ï¼š
export default class User {}
export type User = "admin" | "guest"; // âŒ ç±»å‹ä¸é»˜è®¤å¯¼å‡ºå†²çª
```
:::

## çŸ¥è¯†å›é¡¾

1. **å£°æ˜æ–‡ä»¶**
   - é€šè¿‡ `.d.ts` ä¸º JavaScript æ·»åŠ ç±»å‹ï¼Œæ”¯æŒå…¨å±€å˜é‡å’Œæ¨¡å—å£°æ˜ã€‚
   - ä½¿ç”¨ `declare` å…³é”®å­—å®šä¹‰ç±»å‹ï¼Œæ— éœ€å®ç°ä»£ç ã€‚
2. **export è¯­æ³•**
   - å‘½åå¯¼å‡ºï¼š`export function/class/variable`ã€‚
   - é»˜è®¤å¯¼å‡ºï¼š`export default`ã€‚
   - æ¥å£æ”¯æŒåˆå¹¶æ‰©å±•ã€‚
3. **import è¯­æ³•**
   - åŒºåˆ†é»˜è®¤å¯¼å‡ºå’Œå‘½åå¯¼å‡ºçš„è¯­æ³•ã€‚
   - ä½¿ç”¨ `import type` éš”ç¦»ç±»å‹å¯¼å…¥ï¼Œé¿å…æ‰“åŒ…å†—ä½™ã€‚

## è¯¾åç»ƒä¹ 

1. ï¼ˆå•é€‰ï¼‰ä»¥ä¸‹å“ªç§å†™æ³•å¯ä»¥æ­£ç¡®å¯¼å…¥é»˜è®¤å¯¼å‡ºçš„ `Calculator` ç±»ï¼Ÿ
   A. `import Calculator from "./calculator";`
   B. `import { Calculator } from "./calculator";`
   C. `import * as Calculator from "./calculator";`
   D. `import { default as Calculator } from "./calculator";`

2. ï¼ˆå¡«ç©ºï¼‰ä¸ºä»¥ä¸‹ JavaScript å‡½æ•°ç¼–å†™ç±»å‹å£°æ˜ï¼š
   ```javascript
   // math.js
   export function subtract(a, b) {
     return a - b;
   }
   ```
   å£°æ˜æ–‡ä»¶ä»£ç ï¼š
   ```typescript
   export declare function subtract(____, ____): ____;
   ```

3. ï¼ˆç¼–ç ï¼‰ä¿®å¤ä»¥ä¸‹ä»£ç çš„ç±»å‹é”™è¯¯ï¼š
   ```typescript
   // user.ts
   export default class User {
     id!: number;
   }
   export type UserRoles = "admin" | "user";

   // main.ts
   import User, { UserRoles } from "./user"; // âŒ ç±»å‹å†²çª
   // è¯·ä¿®æ”¹å¯¼å…¥è¯­å¥
   ```

## æ‰©å±•é˜…è¯»

- [TypeScript å®˜æ–¹æ–‡æ¡£ - Modules](https://www.typescriptlang.org/docs/handbook/modules.html)
- [TypeScript å£°æ˜æ–‡ä»¶æŒ‡å—](https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html)
- [TypeScript ä¸­çš„ `import type` è¯¦è§£](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-8.html#type-only-imports-and-export)
